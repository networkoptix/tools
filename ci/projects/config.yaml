
# credentials stored by jenkins and required by our projects
credentials:
  - id: junk_shop_db
    type: name_and_password
  - id: service_email
    type: password
  - id: rdep_publish
    type: ssh_key
  - id: jenkins_hg_push
    type: ssh_key

junk_shop:
  db_host: 10.0.2.101  # host of junk_shop database

services:
  junk_shop_url: http://junkshop.enk.me/
  jira_url: https://networkoptix.atlassian.net/browse
  scm_browser_url_format: http://enk.me:8082/{repository_name}/revision/{revision}
  deployment_path: jenkins@10.0.2.101:/mnt/beta-builds/daily  # cinas is mounted at megatron
  mercurial_repository_url: ssh://hg@hdw.mx/

email:
  smtp:
    host: smtp.gmail.com:587
    user: service@networkoptix.com
  from_address: autotest@networkoptix.com
  # who receives emails about broken CI system itself
  ci_admins:
    - vfedorov@networkoptix.com

build:
  # if any file matching this regexp patterns is added or removed since previous build, do full rebuild:
  cmake_version: 3.10.2
  rebuild_cause_file_patterns:
    - ^ci/
    - ^build_utils/
    - \.cmake$
    - CMakeLists.txt
    - \.vcxproj$

unit_tests:
  timeout: 30m

ci:
  # default platforms to build by CI project
  platforms:
    - win-x64
    - linux-x64
    - mac
    - bpi
  # cron schedule to do clean build at night:
  nightly_schedule: 'H 0 * * *'
  enable_concurrent_builds: False
  days_to_keep_old_builds: 3

release:
  enable_concurrent_builds: False
  days_to_keep_old_builds: 5
  hardware_signing:
    - customization: vista
      platform: win-x64
      node: windows-vista-key  # node is ignored for now
    - customization: vista
      platform: win-x86
      node: windows-vista-key  # node is ignored for now

fun_tests:
  platforms:
    - linux-x64
  #  - win-x64
  node: funtest
  timeout: 4h
  port_base: 20000  # base for REST API ports forwarded from vm to host
  port_range: 100  # how many forwarded ports one functional tests run may require, max
  binaries_url: rsync://noptix.enk.me/buildenv/test/
  enable_concurrent_builds: False
  days_to_keep_old_builds: 10

customization_list:
  - default
  - default_cn
  - default_zh_CN
  - cox
  - digitalwatchdog
  - digitalwatchdog_global
  - hanwha
  - ipera
  - ionetworks
  - nutech
  - ras
  - senturian
  - systemk
  - tricom
  - ust
  - vista
  - vmsdemoblue
  - vmsdemoorange

platforms:
  linux-x64:
    build_node: linux
    should_run_unit_tests: yes
    publish_dir: linux
    distributive_mask_list:
      - '*.deb'
    update_mask_list:
      - '*_update-*.zip'
  linux-x86:
    build_node: linux
    should_run_unit_tests: no
    publish_dir: linux
    distributive_mask_list:
      - '*.deb'
    update_mask_list:
      - '*_update-*.zip'
  win-x64:
    build_node: windows
    generator: Visual Studio 15 2017 Win64
    toolset: host=x64
    should_run_unit_tests: yes
    publish_dir: windows
    distributive_mask_list:
      - '*-servertool-*.msi'
      - '*.exe'
    update_mask_list:
      - '*_update-*.zip'
      - '*_debug-*.zip'  # strange, but pdbs go to updates dir
  win-x86:
    build_node: windows
    generator: Visual Studio 15 2017
    toolset: host=x64
    should_run_unit_tests: yes
    publish_dir: windows
    distributive_mask_list:
      - '*-servertool-*.msi'
      - '*.exe'
    update_mask_list:
      - '*_update-*.zip'
      - '*_debug-*.zip'  # strange, but pdbs go to updates dir
  mac:
    build_node: mac
    should_run_unit_tests: yes
    publish_dir: macos
    distributive_mask_list:
      - '*.dmg'
    update_mask_list:
      - '*_update-*.zip'
  bananapi:
    build_node: linux
    should_run_unit_tests: no
    publish_dir: arm
    distributive_mask_list:
      - '*.zip'
    update_mask_list:
      - '*_update-*.zip'
  bpi:
    build_node: linux
    should_run_unit_tests: no
    publish_dir: arm
    distributive_mask_list:
      - '*.zip'
    update_mask_list:
      - '*_update-*.zip'
  rpi:
    build_node: linux
    should_run_unit_tests: no
    publish_dir: arm
    distributive_mask_list:
      - '*.zip'
    update_mask_list:
      - '*_update-*.zip'
  edge1:
    build_node: linux
    should_run_unit_tests: no
    publish_dir: arm
    distributive_mask_list:
      - '*.zip'
    update_mask_list:
      - '*_update-*.zip'
  tx1:
    build_node: linux
    should_run_unit_tests: no
    publish_dir: arm
    distributive_mask_list:
      - '*.tgz'
      - '*.zip'
    update_mask_list: []
  android-arm:
    build_node: linux
    should_run_unit_tests: no
    publish_dir: android
    distributive_mask_list:
      - '*.apk'
    update_mask_list: []
  ios:
    build_node: mac
    generator: Xcode
    should_run_unit_tests: no
    publish_dir: ios
    distributive_mask_list:
      - '*.ipa'
    update_mask_list: []


# if SOME failed tests are in this list, email is sent to their watcher TOO
# if ALL failed tests are in this list, email is sent ONLY to their watcher
tests_watchers:
  cloud:
    watcher_email: Andrey Kolesnikov <akolesnikov@networkoptix.com>
    test_list:
      - unit/cloud_connectivity_ut/*
      - unit/vms_gateway_ut/*
      - unit/nx_network_ut/*
      - unit/cloud_db_ut/*
      - unit/connection_mediator_ut/*
      - unit/cloud_connect_integration_tests/*
      - unit/traffic_relay_ut/*
      - unit/relaying_ut/*
