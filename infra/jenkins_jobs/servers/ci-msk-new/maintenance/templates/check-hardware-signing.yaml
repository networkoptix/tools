
- job-template:
    name: check-hardware-signing
    description: >
      Check that signing using usb hardware signing key still works.
      If it is not, you have to sign in to this machine manually using virt-viewer
      (rdp or ssh won't work), and run autosignin.cmd script, which will enter usb key's password.

    node: '{node}'

    triggers:
    - timed: 'H/10 * * * *'

    wrappers:
    - timestamps

    properties:
    - priority-sorter:
        priority: 1

    builders:
    - batch: |
        if not exist venv (
            virtualenv --system-site-packages venv
        )
    - inline-python-win:
        venv: venv
        command:
          !include-raw: ../_scripts/check-hardware-signing.py

    publishers:
    - email-ext:
        recipients: '{recipients}'
        subject: '[CI failure] CI hardware signing on node {node} is broken.'
        attach-build-log: true
        fixed: true
