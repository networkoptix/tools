# This is special parameter that wraps extended-choice with single-select in
# way which makes it easier and better to configure.
#
# Required parameters:
# - name - name of parameter
# - choices - array options struct, ex: [ [a, A], [b, B], [c, D] .. ]
#   where first item of pair will be used as value for variable, and the second
#   one will be used in UI as value description
# - allowed_choices - array which choices to include in parameter UI - this
#   helps to keep all choices defined once and DRY. Instead of rewriting
#   choices, one may just write which options are allowed. If allowed_choices
#   are not declared, then all options are allowed
#   ex: [ a, c ]
# - default - default value which is selected, ex: "a"
# - dscription - description of parameter visible in UI
- parameter:
    name: better-single-select
    parameters:
    - extended-choice:
        name: '{name}'
        type: 'single-select'
        value: !j2: >-
          {%- if allowed_choices | default([]) -%}
            {%- for c in choices if c[0] in allowed_choices -%}
                {{- c[0] -}}
                {%- if not loop.last -%}
                    {{- ',' -}}
                {%- endif -%}
            {%- endfor -%}
          {%- else -%}
            {%- for c in choices -%}
                {{- c[0] -}}
                {%- if not loop.last -%}
                    {{- ',' -}}
                {%- endif -%}
            {%- endfor -%}
          {%- endif -%}
        value-description: !j2: >-
          {%- if allowed_choices | default([]) -%}
            {%- for c in choices if c[0] in allowed_choices -%}
                {{- c[1] -}}
                {%- if not loop.last -%}
                    {{- ',' -}}
                {%- endif -%}
            {%- endfor -%}
          {%- else -%}
            {%- for c in choices -%}
                {{- c[1] -}}
                {%- if not loop.last -%}
                    {{- ',' -}}
                {%- endif -%}
            {%- endfor -%}
          {%- endif -%}
        default-value: '{default}'
        description: '{description}'
