# Request new build identity
#
# Parameters:
# - pipeline
- builder:
    name: request-new-build-identity
    builders:
    - trigger-builds:
      - project: '{pipeline}.build_number.generator'
        block: true
        predefined-parameters: |
          REQUESTED_BY=$JOB_NAME-$BUILD_NUMBER
          BUILD_DESCRIPTION=$BUILD_DESCRIPTION
    - copyartifact:
        project: '{pipeline}.build_number.generator'
        filter: 'BUILD_IDENTITY.envvar'
        which-build: last-completed
        parameter-filters: REQUESTED_BY=$JOB_NAME-$BUILD_NUMBER
    - inject:
        properties-file: 'BUILD_IDENTITY.envvar'
