- project:
    name: develop-pipeline-mobile

    project: mobile
    junk_shop_host: junkshop.enk.me
    junkshop_db_host: '10.0.0.113'

    version:
    - mobile:
        default-branch: mobile
        use-nx-vms-commit: mobile  # FIXME: this is temp fix

    # SECTION. GLOBAL PIPELINE CONFIG
    # ============================================================

    # comma-separated list of emails to whom send notifications related to builds
    build-watchers: iremizov@networkoptix.com

    build-webadmin: 'false'
    use-webadmin: 'false'
    # Some cmake args are applicable for any builds they are applied at first
    # Run cmake -L / cmake -LH / cmake -LAH to see all configuration options
    cmake_configure_args_global: >-
      -Dbeta=TRUE
      -DdeveloperBuild=OFF
      -DcloudGroup=test

    # SECTION. PIPELINE CONFIG
    # ============================================================

    pipeline:
    - develop:
        junkshop_project_name: ci
        # Pipeline-specific cmake arguments
        cmake_configure_args_pipeline: ''

    # SECTION. PLATFORM CONFIG
    # ============================================================

    # REMINDER: runner will not change list of subprojects when
    # extra items are added or removed, so don't forget to change runner
    # template according to changes made here
    platform:

    - android-arm:
        # most of builds are linux cross-builds that built on "build-installer-linux"
        # here we make an anchor to avoid typos and other kind of missconfiguration in future
        installer-build-node: &linux_node build-installer-linux
        cmake_configure_args_platform: >-
          -G Ninja
          -DtargetDevice=android-arm
        cmake_build_extra_args: >-
          -- -j 20
    - ios:
        installer-build-node: build-installer-mac
        cmake_configure_args_platform: >-
          -G Xcode
          -DtargetDevice=ios

    # SECTION. CUSTOMIZATION CONFIG
    # ============================================================

    # TODO: There are some customization that may be build only on specific platform
    # there is no need to generate extra set of jobs that never gonna be triggered.
    # it looks like there are too few customization spec. cmake args and we may move such
    # rare customizations to platform enum.

    cmake_configure_args_customization: >-
      -Dcustomization=$CUSTOMIZATION

    customization:

    # TODO: Enable later when we'll be ready to test it.

    # REMINDER: runner will not change list of subprojects when
    # extra items are added or removed, so don't forget to change runner
    # template according to changes made here
    - default

    # list of jobs to generate
    jobs:

    # TRIGGERS - main entry points

    - polling-trigger:
        preset:
        - on-push:
            detailed-job-description: |-
              This trigger serves for automatic builds on every push to remote repository
            default-build-description: >-
              Triggered on push event
            platforms: android-arm,ios
            customizations: default
            ignore-functests: 'true'
    - manual-trigger:
        preset:
        - nightly:
            detailed-job-description: |-
              This trigger serves for nigtly clean builds to verify the state of product
              It builds with corresponding schedule "{timer}".

              It should not be triggered manually excluding debugging of infra problems
              associated with only this trigger type.
            default-build-description: >-
              Nightly clean build for all platforms and customizations
              triggered automatically by timer
            platforms: android-arm,ios
            customizations: default
            clean-workspace: true
            timer: 'H 6 * * 1-5'

    # RUNNER - root launcher of all builds

    - '{pipeline}.{version}.{project}.runner':
        default-platforms: android-arm,ios
        default-customizations: default

    # REGISTRIES

    - '{pipeline}.{version}.{project}.register-build'

    # BUILD AND TEST - main jobs

    # - '{pipeline}.{version}.{project}.webadmin.universal.build'
    - '{pipeline}.{version}.{project}.distribution.{platform}.{customization}.all'
    - '{pipeline}.{version}.{project}.distribution.{platform}.{customization}.build'
