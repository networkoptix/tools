
- job-template:
    name: '{pipeline}.{branch}.vms.installer.{platform}.{customization}.all'
    node: runner
    project-type: multijob

    concurrent: true

    wrppers:
    - build-name:
        name: '[${{BUILD_ID}}] {branch}-${{BUILD_IDENTITY}}@${{NX_VMS_COMMIT}}'
    - timestamps
    # note: DO NOT ADD any timeouts here. Put them in corresponding child jobs.


    parameters:
    - p_CLEAN_WORKSPACE
    - p_CLEAN_CLONE
    - p_CLEAN_BUILD
    - p_BUILD_IDENTITY
    - p_NX_VMS_COMMIT:
        default: '{branch}'

    builders:
    - multijob:
        name: "Build installer for {platform} with {customization}"
        projects:
        - name: '{pipeline}.{branch}.vms.installer.{platform}.{customization}.build'
          kill-phase-on: FAILURE
          predefined-parameters: |
            CLEAN_WORKSPACE=$CLEAN_WORKSPACE
            CLEAN_CLONE=$CLEAN_CLONE
            CLEAN_BUILD=$CLEAN_BUILD
            BUILD_IDENTITY=$BUILD_IDENTITY
            NX_VMS_COMMIT=$NX_VMS_COMMIT

    - multijob:
        name: Run tests (tests are optional, only existing jobs are built)
        projects:
        - name: '{pipeline}.{branch}.vms.installer.{platform}.{customization}.unittest' # TODO:
          kill-phase-on: NEVER
          predefined-parameters: |
            CLEAN_WORKSPACE=$CLEAN_WORKSPACE
            CLEAN_CLONE=$CLEAN_CLONE
            CLEAN_BUILD=$CLEAN_BUILD
            BUILD_IDENTITY=$BUILD_IDENTITY
            NX_VMS_COMMIT=$NX_VMS_COMMIT

        - name: '{pipeline}.{branch}.vms.installer.{platform}.{customization}.perftest' # TODO:
          kill-phase-on: NEVER
          predefined-parameters: |
            CLEAN_WORKSPACE=$CLEAN_WORKSPACE
            CLEAN_CLONE=$CLEAN_CLONE
            CLEAN_BUILD=$CLEAN_BUILD
            BUILD_IDENTITY=$BUILD_IDENTITY
            NX_VMS_COMMIT=$NX_VMS_COMMIT

        - name: '{pipeline}.{branch}.vms.installer.{platform}.{customization}.functest' # TODO:
          kill-phase-on: NEVER
          predefined-parameters: |
            CLEAN_WORKSPACE=$CLEAN_WORKSPACE
            CLEAN_CLONE=$CLEAN_CLONE
            CLEAN_BUILD=$CLEAN_BUILD
            BUILD_IDENTITY=$BUILD_IDENTITY
            NX_VMS_COMMIT=$NX_VMS_COMMIT