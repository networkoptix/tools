- job-template:
    name: '{pipeline}.helper.promote-build'
    id: helpers/promote-build

    description: |
      <pre>
      ================================================================================
      Build Promotion
      ================================================================================

      Create symlinks to beta-builds/daily, so build files will be accessible
      for DepCon.

      </pre>

    node: repository-ops
    concurrent: false

    parameters:
    - p_BUILD_DESCRIPTION:
        default: ''
    - p_BRANCH
    - p_NX_VMS_COMMIT
    - p_BUILD_IDENTITY
    - p_PIPELINE(hidden):
        default: '{pipeline}'

    wrappers:
    - timestamps
    - timeout:
        timeout: 20 # min
        fail: true
        type: absolute

    builders:
    - decorators/set-custom-build-description
    - build-name-setter:
        template: '#$BUILD_ID $BRANCH-$BUILD_IDENTITY@$NX_VMS_COMMIT'
        macro: true
    - repository/promote-to-daily:
        artifact_repository_base_path: '{artifact_repository_base_path}'
        # platform dir name mapping: repository -> daily builds
        platform_map:
          - [linux-x64, linux]
          - [linux-x86, linux]
          - [windows-x64, windows]
          - [windows-x86, windows]
          - [mac, macos]
          - [ios, ios]
          - [android-arm, android]
          - [bananapi, arm]
          - [bpi, arm]
          - [rpi, arm]
          - [edge1, arm]
          - [tx1, arm]

    publishers:
    - failure-email-helpers(maintainers):
        email-recipients: '{job_maintainers}'
