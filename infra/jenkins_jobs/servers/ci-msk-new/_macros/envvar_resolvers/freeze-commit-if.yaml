# Conditionally freeze commit
#
# If given env "var" equals to "val", then commit "commit_to_freeze" will be
# captured into variable passed to "as" param.
#
# Parameters:
# - var
# - val
# - pipeline
# - commit_to_freeze
# - as
- builder:
    name: freeze-commit-if(var=val)
    builders:
    - conditional-step:
        condition-kind: strings-match
        condition-string1: '${var}'
        condition-string2: '{val}'
        steps:
        - inject: {} # workaround: must have >1 builder to correctly expand macro
        - freeze-nx-vms-commit(remote):
            pipeline: '{pipeline}'
            branch: $BRANCH
            commit-to-freeze: '{commit_to_freeze}'
            commit-varname: '{as}'
