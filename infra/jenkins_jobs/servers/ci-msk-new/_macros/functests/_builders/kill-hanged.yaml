- builder:
    name: functests/kill-hanged
    builders:
    - shell: |
        #!/bin/bash
        set -ex
        function kill_gently {
            kill -2 "$1" && timeout "$2" tail --pid "$1" -f /dev/null || kill -9 $1
        }
        function find_pid {
          ps aux | grep "$WORKSPACE" | grep pytest | tail -1 | awk '{print $2}'
        }

        while [ ! -z "$(find_pid)" ] ; do
          pid=$(ps aux | grep "$WORKSPACE" | grep pytest | tail -1 | awk '{print $2}')

          kill_gently "$(find_pid)" 300
        done
