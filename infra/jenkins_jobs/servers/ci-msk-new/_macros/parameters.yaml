
# specific parameter for "registry-like" jobs
- parameter:
    name: p_REQUESTED_BY
    parameters:
    - string:
        name: REQUESTED_BY
        default: ''
        description: |
          Sticky label to mark individual build and query it's artifact in future
- parameter:
    name: p_UPSTREAM_JOB_NAME
    parameters:
    - string:
        name: UPSTREAM_JOB_NAME
        default: ''
        description: |
          JOB_NAME of upstream job - that is job which triggered this one.
- parameter:
    name: p_BUILD_DESCRIPTION
    parameters:
    - string:
        name: BUILD_DESCRIPTION
        default: '{default}'
        description: >-
          Free-style field to add some description for this build.
          This description will be posted on build page and also used in email notification.
          Use it to distinct one build from another.

# Common build parameters and build process customizations
- parameter:
    name: p_CLEAN_WORKSPACE  # TODO: switch to on-off-option
    parameters:
    - bool:
        name: CLEAN_WORKSPACE
        default: '{default}'
        description: >-
          Build strategy, don't even try to reuse existing workspace.
          Clean EVERYTHING (HG repos, build, distrib and other folders).

- parameter:
    name: p_CLEAN_CLONE  # TODO: switch to on-off-option
    parameters:
    - bool:
        name: CLEAN_CLONE
        default: false
        description: >-
          Build strategy, don't try to reuse currently cloned repositories.
          Clean repositories folders and reclone HG repos.

- parameter:
    name: p_CLEAN_BUILD  # TODO: switch to on-off-option
    parameters:
    - bool:
        name: CLEAN_BUILD
        default: '{default}'
        description: >-
          Build strategy, don't try to reuse build folder from previous build in this workspace.
          This is very useful if you suspect that system incorrectly tries to perform incremental
          build that's not possible under current circumstances.

- parameter:
    name: p_BUILD_WEBADMIN
    parameters:
    - bool:
        name: BUILD_WEBADMIN
        default: '{default}'
        description: >-
          Normally you need to build webadmin, but there are few cases when you don't.
          For example, if build is related to only platform w/o servers included or when webadmin
          is already built and published under the same build identity.


# Parameters That fully define artifacts: what sources used and where to put what's built
- parameter:
    name: p_PIPELINE
    parameters:
    - string: &p_PIPELINE_OPTS
        name: PIPELINE
        default: '{default}'
        description: >-
          Build pipeline pipeline (e.g. custom, release and others)
- parameter:
    name: p_PIPELINE(hidden)
    parameters:
    - hidden: *p_PIPELINE_OPTS

- parameter:
    name: p_BRANCH
    parameters:
    - string: &p_BRANCH_OPTS
        name: BRANCH
        default: '{default}'
        description: >-
          Branch of nx_vms from which product is built.
- parameter:
    name: p_BRANCH(hidden)
    parameters:
    - hidden: *p_BRANCH_OPTS

- parameter:
    name: p_NX_VMS_COMMIT
    parameters:
    - string:
        name: NX_VMS_COMMIT
        default: '{default}'
        description: >-
          Frozen nx_vms commit id or branch. commit sha is preferred as
          all builds will be produced within the same repo state

- parameter:
    name: p_USE_NX_VMS_COMMIT
    parameters:
    - string:
        name: USE_NX_VMS_COMMIT
        default: '{default}'
        description: >-
          Use AUTO, LATEST, branch name or exact sha of commit

- parameter:
    name: p_BUILD_IDENTITY
    parameters:
    - string:
        name: BUILD_IDENTITY
        default: ''
        description: >-
          Build number in context of this pipeline.

- parameter:
    name: p_USE_BUILD_IDENTITY
    parameters:
    - string:
        name: USE_BUILD_IDENTITY
        default: '{default}'
        description: >-
          Use NEW, or existing build

- parameter:
    name: p_PLATFORMS
    parameters:
    - better-multi-select:
        name: PLATFORMS
        default: '{default}'
        description: Target platforms for distributions
        choices:
        - [ linux-x64,      linux-x64 ]
        - [ linux-x86,      linux-x86 ]
        - [ bananapi,       bananapi ]
        - [ windows-x86,    windows-x86 ]
        - [ windows-x64,    windows-x64 ]
        - [ mac,            mac ]
        - [ edge1,          edge1 ]
        - [ bpi,            bpi ]
        - [ rpi,            rpi ]
        - [ tx1,            tx1 ]
        - [ ios,            ios ]
        - [ android-arm,    android-arm ]
        allowed_choices: '{allowed_choices}'
- parameter:
    name: p_PLATFORMS(hidden)
    parameters:
    - hidden:
        name: PLATFORMS
        default: '{default}'

- parameter:
    name: p_PLATFORM
    parameters:
    - string: &p_PLATFORM_OPTS
        name: PLATFORM
        default: '{default}'
        description: >
          Target platform for installer (e.g. linux-x64, windows-x86 and others,
          note that universal is used for webadmin and other platform-independent components)

- parameter:
    name: p_PLATFORM(hidden)
    parameters:
    - hidden: *p_PLATFORM_OPTS

- parameter:
    name: p_CUSTOMIZATIONS
    parameters:
    - better-multi-select:
        name: CUSTOMIZATIONS
        default: '{default}'
        description: Target customizations for distributions
        choices:
        - [ default,                default ]
        - [ default_cn,             default_cn ]
        - [ default_zh_CN,          default_zh_CN ]
        - [ cox,                    cox ]
        - [ digitalwatchdog,        digitalwatchdog ]
        - [ digitalwatchdog_global, digitalwatchdog_global ]
        - [ hanwha,                 hanwha ]
        - [ ipera,                  ipera ]
        - [ ionetworks,             ionetworks ]
        - [ nutech,                 nutech ]
        - [ ras,                    ras ]
        - [ senturian,              senturian ]
        - [ systemk,                systemk ]
        - [ tricom,                 tricom ]
        - [ ust,                    ust ]
        - [ vista,                  vista ]
        - [ vmsdemoblue,            vmsdemoblue ]
        - [ vmsdemoorange,          vmsdemoorange ]
        - [ metavms,                metavms ]
        - [ xccelo,                 xccelo ]
        allowed_choices: '{allowed_choices}'
- parameter:
    name: p_CUSTOMIZATIONS(hidden)
    parameters:
    - hidden:
        name: CUSTOMIZATIONS
        default: '{default}'

- parameter:
    name: p_CUSTOMIZATION
    parameters:
    - string: &p_CUSTOMIZATION_OPTS
        name: CUSTOMIZATION
        default: '{default}'
        description: >
          Name of installer customization (e.g. default, hanwha and others)
- parameter:
    name: p_CUSTOMIZATION(hidden)
    parameters:
    - hidden: *p_CUSTOMIZATION_OPTS

- parameter:
    name: p_COMPONENTS
    parameters:
    - string:
        name: COMPONENTS
        default: ''
        description: >
          Name of components, mostly used in context of artifact repository as part of path
          where artifact will be located (uploaded to or downloaded from) â€” comma-separated list.
          Note that trailing slash matters.

# Utility parameters used to describe connection details
- parameter:
    name: p_NODE_SSH_CONNECTION
    parameters:
    - string:
        name: NODE_SSH_CONNECTION
        default: ''
        description: >
          Original ssh connection from Jenkins SSH_CONNECTION envvar,
          (<src host> <src port> <dst host> <dst port> NOTE, FOUR VARS in string),
          example - 192.168.13.105 43896 192.168.13.116 22

- parameter:
    name: p_SSH_USER
    parameters:
    - string:
        name: SSH_USER
        description: >
          Name of ssh user used for ssh session (usually jenkins, but it may differ for
          edge cases)

# Define paths to operate on
- parameter:
    name: p_LOCAL_PATH
    parameters:
    - string:
        name: LOCAL_PATH
        default: ''
        description: >
          Local path on remote host

# Advanced usage
- parameter:
    name: administrative-section-separator
    parameters:
    - parameter-separator/simple:
        header: >-
          Special section for administrative/maintenance purposes..
          DON'T MODIFY anything if you are not administrator

- parameter:
    name: p_BUILD_STATUS
    parameters:
    - string:
        name: BUILD_STATUS
        default: passed
        description: >-
          Build status to report, note that THIS ENUM DOES NOT CONFORM
          with JENKINS ENUMs, valid options are "passed" and "failed"

- parameter:
    name: p_RUN_FUNCTESTS  # TODO: switch to on-off-option
    parameters:
    - bool:
        name: RUN_FUNCTESTS
        default: '{default}'
        description: >-
          Flag whether run functests or not.

- parameter:
    name: p_RUN_REALCAMERATESTS  # TODO: switch to on-off-option
    parameters:
    - bool:
        name: RUN_REALCAMERATESTS
        default: '{default}'
        description: >-
          Flag whether run realcameratests or not.

- parameter:
    name: p_RUN_UNITTESTS  # TODO: switch to on-off-option
    parameters:
    - bool:
        name: RUN_UNITTESTS
        default: '{default}'
        description: >-
          Flag whether run functests or not.

- parameter:
    name: p_BUILD_INSTALLER  # TODO: switch to on-off-option
    parameters:
    - bool:
        name: BUILD_INSTALLER
        default: '{default}'
        description: >-
          Flag whether to build installer or not

- parameter:
    name: p_RUNNER_URL
    parameters:
    - string:
        name: RUNNER_URL
        description: utility parameter, url for root build (runner)

- parameter:
    name: p_CUSTOM_CMAKE_PARAMETERS
    parameters:
    - string:
        name: CUSTOM_CMAKE_PARAMETERS
        default: '{default}'
- parameter:
    name: p_CUSTOM_CMAKE_PARAMETERS(hidden)
    parameters:
    - hidden:
        name: CUSTOM_CMAKE_PARAMETERS
        default: '{default}'

- parameter:
    name: p_CLOUD_GROUP
    parameters:
    - better-single-select:
        name: CLOUD_GROUP
        choices:
        - [ test,   test  ]   # TODO: Write description
        - [ tmp,    tmp   ]   # TODO: Write description
        - [ dev,    dev   ]   # TODO: Write description
        - [ demo,   demo  ]   # TODO: Write description
        - [ stage,  stage ]   # TODO: Write description
        - [ prod,   prod  ]   # TODO: Write description
        default: '{default}'
        description: >-
          Cloud group
- parameter:
    name: p_CLOUD_GROUP(hidden)
    parameters:
    - hidden:
        name: CLOUD_GROUP
        default: '{default}'

- parameter:
    name: p_BETA
    parameters:
    - on-off-option:
        name: BETA
        default: '{default}'
        description: "ON will add BETA banner for build"
- parameter:
    name: p_BETA(hidden)
    parameters:
    - hidden:
        name: BETA
        default: '{default}'

- parameter:
    name: p_CODE_SIGNING
    parameters:
    - on-off-option:
        name: CODE_SIGNING
        default: '{default}'
- parameter:
    name: p_CODE_SIGNING(hidden)
    parameters:
    - hidden:
        name: CODE_SIGNING
        default: '{default}'

- parameter:
    name: p_TRUSTED_TIMESTAMPING
    parameters:
    - on-off-option:
        name: TRUSTED_TIMESTAMPING
        default: '{default}'
- parameter:
    name: p_TRUSTED_TIMESTAMPING(hidden)
    parameters:
    - hidden:
        name: TRUSTED_TIMESTAMPING
        default: '{default}'

# Functional tests parameters

- parameter:
    name: p_TEST_SELECT_EXPR
    parameters:
    - string:
        name: TEST_SELECT_EXPR
        default: '{default}'
        description: >
          Test selection expression, parameter for pytest '-k' option.
          Empty means run all tests specified in TEST_LIST parameter below.
          Example: 'not windows and not smb' to exclude all windows and samba tests.
          Value is passed as single argument enclosed with quotes. E.g. 'linux and ssh' would end up as '-k "linux and ssh"'.
          See: https://docs.pytest.org/en/latest/example/markers.html#using-k-expr-to-select-tests-based-on-their-name
- parameter:
    name: p_TEST_SELECT_EXPR(hidden)
    parameters:
    - hidden:
        name: TEST_SELECT_EXPR
        default: '{default}'

- parameter:
    name: p_TEST_LIST
    parameters:
    - string:
        name: TEST_LIST
        default: '{default}'
        description: Tests to run, space-delimited list. Empty means run all tests.
- parameter:
    name: p_TEST_LIST(hidden)
    parameters:
    - hidden:
        name: TEST_LIST
        default: '{default}'

- parameter:
    name: p_VMS_BUILD_CHOICE_w_OPTION
    parameters:
    - better-single-select:
        name: VMS_BUILD_CHOICE
        choices:
        - - VMS_NEW_BUILD_BY_COMMIT
          - "Make new build (ENTER commit)"
        - - VMS_EXIST_BUILD_BY_IDENTITY
          - "Existing build (ENTER build identity)"
        - - VMS_EXISTING_BUILD_FROM_STABLE_PUSH
          - "Existing green build (latest push)"
        - - VMS_EXISTING_BUILD_FROM_STABLE_NIGHTLY
          - "Existing green build (latest nightly)"
        - - VMS_EXISTING_BUILD_FROM_STABLE_PUSH_OR_NIGHTLY
          - "Existing green build (latest push or nightly)"
        default: '{default}'
        description: >-
          Which VMS build should be used
    - string:
        name: VMS_BUILD_CHOICE_OPTION
        default: '{option_default}'
        description: >-
          ENTER option for VMS_BUILD_CHOICE, optional, depending on what's selected in prev field
- parameter:
    name: p_VMS_BUILD_CHOICE_w_OPTION(hidden)
    parameters:
    - hidden:
        name: VMS_BUILD_CHOICE
        default: '{default}'
    - hidden:
        name: VMS_BUILD_CHOICE_OPTION
        default: '{option_default}'

- parameter:
    name: p_FT_COMMIT_CHOICE_w_OPTION
    parameters:
    - better-single-select:
        name: FT_COMMIT_CHOICE
        choices:
        - - "FT_OTHER_COMMIT"
          - "Use other commit (ENTER commit)"
        - - "FT_STABLE_PUSH"
          - "Tested green (latest push)"
        - - "FT_STABLE_NIGHTLY"
          - "Tested green (latest nightly)"
        - - "FT_STABLE_PUSH_OR_NIGHTLY"
          - "Tested green(latest push or nightly)"
        default: '{default}'
        description: Which FT commit should be used
    - string:
        name: FT_COMMIT_CHOICE_OPTION
        default: '{option_default}'
        description: >-
          ENTER option for FT_COMMIT_CHOICE, optional, depending on what's selected in prev field

- parameter:
    name: p_FT_COMMIT_CHOICE_w_OPTION(hidden)
    parameters:
    - hidden:
        name: FT_COMMIT_CHOICE
        default: '{default}'
    - hidden:
        name: FT_COMMIT_CHOICE_OPTION
        default: '{option_default}'

- parameter:
    name: p_RCT_COMMIT_CHOICE_w_OPTION
    parameters:
    - better-single-select:
        name: RCT_COMMIT_CHOICE
        choices:
        - - "RCT_BY_COMMIT"
          - "Use other commit (ENTER commit)"
        - - "RCT_STABLE_PUSH"
          - "Tested green (latest push)"
        - - "RCT_STABLE_NIGHTLY"
          - "Tested green (latest nightly)"
        - - "RCT_STABLE_PUSH_OR_NIGHTLY"
          - "Tested green(latest push or nightly)"
        default: '{default}'
        description: Which RCT commit should be used
    - string:
        name: RCT_COMMIT_CHOICE_OPTION
        default: '{option_default}'
        description: >-
          ENTER option for RCT_COMMIT_CHOICE, optional, depending on what's selected in prev field

- parameter:
    name: p_RCT_COMMIT_CHOICE_w_OPTION(hidden)
    parameters:
    - hidden:
        name: RCT_COMMIT_CHOICE
        default: '{default}'
    - hidden:
        name: RCT_COMMIT_CHOICE_OPTION
        default: '{option_default}'

- parameter:
    name: p_ST_COMMIT_CHOICE_w_OPTION
    parameters:
    - better-single-select:
        name: ST_COMMIT_CHOICE
        choices:
        - [ST_LATEST, "Latest nx_vms commit from the branch"]
        - [ST_STABLE, "Latest stable self-ft commit (push or nightly)"]
        - [ST_BY_COMMIT, "Particular (ENTER commit)"]
        default: '{default}'
        description: Which nx_vms commit should be used for test itself
    - string:
        name: ST_COMMIT_CHOICE_OPTION
        default: '{option_default}'
        description: >-
          ENTER option for ST_COMMIT, optional, depending on what's selected in prev field

- parameter:
    name: p_RCT_CAMERA_FILTER
    parameters:
    - string:
        name: RCT_CAMERA_FILTER
        default:  !j2: '{{ default | default("*") }}'
        description:

- parameter:
    name: p_RCT_CAMERA_FILTER(hidden)
    parameters:
    - hidden:
        name: RCT_CAMERA_FILTER
        default:  !j2: '{{ default | default("*") }}'

- parameter:
    name: p_ST_COMMIT_CHOICE_w_OPTION(hidden)
    parameters:
    - hidden:
        name: ST_COMMIT_CHOICE
        default: '{default}'
    - hidden:
        name: ST_COMMIT_CHOICE_OPTION
        default: '{option_default}'

- parameter:
    name: p_ST_SCENARIOS
    parameters:
    - extended-choice:
        name: ST_SCENARIOS
        type: 'multi-select'
        value:  '{default}'
        default-value:  '{default}'
        visible-items: 10
        description: >-
          Comma-separated list of scalability test runs, in form: 50-lws or 100-full

- parameter:
    name: p_ST_SCENARIOS(hidden)
    parameters:
    - hidden:
        name: ST_SCENARIOS
        default: '{default}'
