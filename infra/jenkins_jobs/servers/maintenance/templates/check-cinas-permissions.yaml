- job-template:
    name: check-cinas-permissions
    description: >
      Check if cinas beta-builds directory still has proper permissions, and
      jenkins is able to write to it

    node: megatron-host
    logrotate:
      daysToKeep: 10

    file_path: '/mnt/beta-builds/daily/jenkins-check-cinas-permissions'

    triggers:
      - timed: 'H/5 * * * *'

    wrappers:
      - timestamps

    builders:
      - shell: |
          #!/bin/bash -xe
          touch "{file_path}"
          ls $(dirname "{file_path}") | grep $(basename "{file_path}")
          rm "{file_path}"

    publishers:
      - email-ext:
          recipients: '{recipients}'
          subject: '[CI failure] CI NAS permissions check'
          attach-build-log: true
          fixed: true
