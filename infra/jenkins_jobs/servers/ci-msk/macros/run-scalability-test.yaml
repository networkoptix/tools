- builder:
    name: run-scalability-test

    # A wrapper for running scalability test
    #
    # Required template variables:
    # * use_lightweight_servers
    # * server_count
    #
    # Required environment variables:
    # * JUNK_SHOP_CAPTURE_DB (user:password@host[:port])
    # * BRANCH
    # * BUILD_NUM
    # * CUSTOMIZATION
    # * PLATFORM

    builders:
    - extended-bash:
        headers: |
          #!/bin/bash
          set -ex

          # must be injected by job template
          : ${{JUNK_SHOP_CAPTURE_DB:?}}
          : ${{BRANCH:?}}
          : ${{BUILD_NUM:?}}
          : ${{CUSTOMIZATION:?}}
          : ${{PLATFORM:?}}

          export USE_LIGHTWEIGHT_SERVERS={use_lightweight_servers}
          export SERVER_COUNT={server_count}
        script:
          !include-raw-escape:
            - includes/join_by.sh
            - ../builders/run-scalability-test.sh
