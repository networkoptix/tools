# continuous integration job - build and test certain platforms on commits


- job-template:
    name: '{project-name}-{branch}'
    project-type: multijob
    node: runner
    customization: default

    parameters:
      - bool:
          name: CLEAN
          default: false
          description: remove workspace before build
      - bool:
          name: CLEAN_BUILD
          default: false
          description: make clean build
      - bool:
          name: BUILD_WEBADMIN
          default: true
          description: Build webadmin
      - bool:
          name: DO_BUILD
          default: true
          description: Do actually build platforms, or just reuse results from previous build
      - bool:
          name: RUN_UNIT_TESTS
          default: true
          description: Run unit tests

    wrappers:
    - timestamps
    - timeout:
        timeout: 360

    builders:
      - multijob:
          name: init-build
          projects:
            - name: '{project-name}-{branch}-init-build'
              kill-phase-on: FAILURE
              predefined-parameters: |
                CLEAN=$CLEAN
                CUSTOMIZATION={customization}
                ROOT_BUILD_NUMBER=$BUILD_NUMBER
                ROOT_BUILD_URL=$BUILD_URL
      - multijob:
          name: webadmin
          projects:
            - name: '{project-name}-{branch}-webadmin'
              kill-phase-on: FAILURE
              predefined-parameters: |
                CLEAN=$CLEAN
                CLEAN_BUILD=$CLEAN_BUILD
                CUSTOMIZATION={customization}
                ROOT_BUILD_NUMBER=$BUILD_NUMBER
                DO_BUILD=$BUILD_WEBADMIN
      - multijob:
          name: build-and-unittest
          condition: UNSTABLE
          projects:
            - name: '{project-name}-{branch}-linux-x64'
              kill-phase-on: NEVER
              predefined-parameters: |
                CLEAN=$CLEAN
                CLEAN_BUILD=$CLEAN_BUILD
                CUSTOMIZATION={customization}
                ROOT_BUILD_NUMBER=$BUILD_NUMBER
                DO_BUILD=$DO_BUILD
                RUN_UNIT_TESTS=$RUN_UNIT_TESTS
