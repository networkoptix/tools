# execute python script
# params:
# * args
# * script

# Usage example:
#  - inline-python-{os}:
#      args:
#        arg1: value-1
#        arg2: 'value 2'
#      script:
#        !include-raw: some-python-script.py


# Implementation
- builder:
    name: inline-python-impl-create-file
    builders:
      - file-create:
          path: __inline_python.py
          contents: |
            from collections import OrderedDict
            args={args}
            #==================================
            {script}

- builder:
    name: inline-python-windows-impl
    builders:
      - inline-python-impl-create-file:
          args: '{args}'
          script: '{script}'
      - batch: |
          if not exist venv (
            echo "Include init-venv macro first!" 1>&2
            exit 1
          )
          type __inline_python.py
          venv\\Scripts\\python.exe __inline_python.py

- builder:
    name: inline-python-posix-impl
    builders:
      - inline-python-impl-create-file:
          args: '{args}'
          script: '{script}'
      - shell: |
          if [ ! -d venv ]; then
            echo "Include init-venv macro first!" 1>&2
            exit 1
          fi
          cat __inline_python.py
          venv/bin/python __inline_python.py

# Interface
- builder:
    name: inline-python-windows
    builders:
      - inline-python-windows-impl:
          args: '{args}'
          script: '{script}'

- builder:
    name: inline-python-linux
    builders:
      - inline-python-posix-impl:
          args: '{args}'
          script: '{script}'

- builder:
    name: inline-python-mac
    builders:
      - inline-python-posix-impl:
          args: '{args}'
          script: '{script}'
