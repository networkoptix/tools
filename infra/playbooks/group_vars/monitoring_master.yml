prometheus_web_external_url: "http://{{ ansible_ssh_host }}:9090"

prometheus_targets:
  node:
  - targets:
      "{{ groups['all'] | map('extract', hostvars, ['node_exporter_address']) | map('regex_replace', '$', ':9100') | list }}"
    labels:
      env: monitoring
  grafana:
  - targets:
    - "{{ ansible_ssh_host }}:3000"
    labels:
      env: monitoring

prometheus_scrape_configs:
- job_name: "windows"
  metrics_path: "/metrics"
  static_configs:
  - targets:
      "{{ groups['build_vm_win'] | map('extract', hostvars, ['node_exporter_address']) | map('regex_replace', '$', ':9182') | list }}"
- job_name: "prometheus"
  metrics_path: "/metrics"
  static_configs:
  - targets:
    - "{{ ansible_ssh_host }}:9090"
- job_name: "node"
  file_sd_configs:
  - files:
    - "/etc/prometheus/file_sd/node.yml"
- job_name: "grafana"
  file_sd_configs:
  - files:
    - "/etc/prometheus/file_sd/grafana.yml"

grafana_security:
  admin_user: admin
  admin_password: "{{ grafana_database_password }}"

grafana_auth:
  anonymous:
    org_name: "NetworkOptix"
    org_role: Viewer

prometheus_grafana_datasource: "Prometheus"

grafana_datasources:
  - name: "{{ prometheus_grafana_datasource }}"
    type: "prometheus"
    access: "proxy"
    url: "http://{{ ansible_ssh_host }}:9090"
    isDefault: true

#  Grafana role uses dashbordId to download a dashbord by request
# https://grafana.com/api/dashboards/{{ dashboard_id }}/revisions/{{ revision_id }}/download"
#
# You can find information about dashboards and its revisions
# on https://grafana.com/dashboards page,
grafana_dashboards:
  # Node Exporter Full dashboard
  - dashboard_id: '1860'
    revision_id: '11'     # node exporter dashboard last revision
    datasource: '{{ prometheus_grafana_datasource }}'
  # Overview of metrics from Prometheus 2.0
  - dashboard_id: '3662'
    revision_id: '2'      # Prometheus metrics dashboard last revision
    datasource: '{{ prometheus_grafana_datasource }}'
  # Windows Node dashboard
  - dashboard_id: '2129'
    revision_id:  '3'     # windows node dashboard last revision
    datasource: '{{ prometheus_grafana_datasource }}'
