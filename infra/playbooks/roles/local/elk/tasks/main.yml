- name: install apt-transport-https to support HTTPS APT downloads
  apt:
    name: apt-transport-https

- name: add APT key
  apt_key:
    url: "https://artifacts.elastic.co/GPG-KEY-elasticsearch"

- name: add APT repo
  apt_repository:
    repo: "deb https://artifacts.elastic.co/packages/6.x/apt stable main"

- name: install from APT
  apt:
    name:
    - "elasticsearch"
    - "kibana"
    - "logstash"

- name: copy all config files
  copy:
    src: "etc/"
    dest: "/etc/"

- name: reload systemd configuration and restart services
  shell: |
    systemctl daemon-reload
    systemctl enable elasticsearch kibana logstash
    systemctl restart elasticsearch kibana logstash
