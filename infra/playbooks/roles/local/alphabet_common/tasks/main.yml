---
- name: Add all infra hosts into /etc/hosts
  lineinfile:
    path: /etc/hosts
    line: "{{ item }}"
    state: present
  with_items:
  # rack net does not have dns and won't have
  # FIXME: Unhardcode and make templated based on host vars
  - 192.168.13.2 cinas
  - 192.168.13.3 alpha
  - 192.168.13.4 beta
  - 192.168.13.5 gamma

- name: Install general packages
  apt:
    name: "{{ item }}"
    state: present
  with_items:
  - python-lxml
  when:
  - ansible_os_family is defined
  - ansible_os_family == 'Debian'

- name: Add mercurial repos to known host
  lineinfile:
    dest: "/etc/ssh/ssh_known_hosts"
    create: yes
    state: present
    regexp: "^{{ item | regex_escape() }}"
    line: "{{ lookup('pipe', 'ssh-keyscan -t rsa {{ item }}') }}"
  with_items:
  - enk.me
  - hdw.mx

- name: Allow sudoers to run sudo without password
  lineinfile:
    dest: "/etc/sudoers"
    state: present
    regexp: "^{{ '%sudo' | regex_escape() }}"
    line: "%sudo   ALL=(ALL) NOPASSWD:ALL"
