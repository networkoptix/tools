- name: Create Windows (server 2016) build VMs
  hosts: build_vm_win
  become: true
  become_method: sudo
  # We don't know status of guest, so if we try to gather facts (=connect),
  # but this guest is not crated yet, we'll fail entire section.
  # That's why don't collect facts here.
  # All facts will be collected in libvirt_guest.
  gather_facts: no

  vars_files:
  - ../secrets/windows_build.yml
  - ../secrets/autosign.yml

  roles:
  - role: libvirt_guest
  - role: windows_build_node
    become: false
    when:
    - libvirt_guest__state is defined
    - libvirt_guest__state == 'running'
    - libvirt_guest__type  == 'windows'
  - role: windows_sign_tool
    become: false
    when:
    - libvirt_guest__state is defined
    - libvirt_guest__state == 'running'
    - libvirt_guest__type  == 'windows'
    - install_sign_tool == true
