- name: Setup libvirt on KVM hosts
  hosts: libvirt_host
  become: true
  become_method: sudo

  vars_files:
  - ../secrets/infra_storage.yml
  
  roles:
  - role: samba_share
    become: true
    become_method: sudo
    when: 
    - libvirt_guest__state is undefined or libvirt_guest__current_state == 'running'
    # temp. workaround for local deployments
    - attach_infra_share | default(True) == True
    vars:
      samba_mount_pass: "{{ cinas_infra_password }}"
  - role: alphabet_common
  - role: libvirt_host
  # TODO we need to move base images to NAS and extract image creation project
  - role: image_library
