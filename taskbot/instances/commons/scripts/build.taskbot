# -*- sh -*-

set -o errexit +o nounset -o noclobber

cd "$TASKBOT_VAR"/nx_vms

# + Incremental build
set +o errexit
mvn package -e -T4 -Dbuild.configuration=release -Dutb -Dclean=false 2>&1
RC=$?
if [ $RC -eq 0 ]; then
    exit 0
fi
set -o errexit

# + Clean
set +o errexit
mvn clean -Dutb -Dmaven.clean.failOnError=false
set -o errexit
hg purge . --all

#+ Build from stratch
mvn package -e -T4 -Dbuild.configuration=release -Dutb 2>&1
